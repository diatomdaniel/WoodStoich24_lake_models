"0",""
"0","# dynamic model"
"0","# apply over scenarios and algal groups"
"0","dynamic.gpp <-  lapply(list(dynamic.algae, dynamic.diatoms, dynamic.greens, dynamic.cyanos), function(x) {"
"0","  params <- x"
"0","  lapply(1:nrow(loads), function(i) {"
"0","    params[""Pin""] = loads[i, ""Pin""]"
"0","    params[""Nin""] = loads[i, ""Nin""]"
"0","    y <- c(""A1"" = 100, ""P"" = loads[i, ""Pin""],""N"" = loads[i, ""Nin""], ""QP1"" = 0.015, ""QN1"" = 0.1)"
"0","    run <- ode(y, times, parms = params, func = dynamic.stoich)"
"0","    return(run[max(times),])"
"0","  })"
"0","})"
"0","# extract from list and convert to data-frame"
"0","dynamic.gpp.average <- as_data_frame(do.call(rbind, dynamic.gpp[[1]]))"
"0","dynamic.gpp.diatoms <- as_data_frame(do.call(rbind, dynamic.gpp[[2]]))"
"0","dynamic.gpp.greens <- as_data_frame(do.call(rbind, dynamic.gpp[[3]]))"
"0","dynamic.gpp.cyanos <- as_data_frame(do.call(rbind, dynamic.gpp[[4]]))"
"0",""
"0","# bind together"
"0","dynamic.gpp.df <- bind_rows(dynamic.gpp.average, dynamic.gpp.diatoms, "
"0","                            dynamic.gpp.greens, dynamic.gpp.cyanos) %>%"
"0","  mutate(model = rep(""dynamic"", nrow(loads) * 4),"
"0","         species = rep(c(""average"", ""diatoms"", ""greens"", ""cyanos""), each = nrow(loads)),"
"0","         Pin = rep(loads$Pin, 4), "
"0","         Nin = rep(loads$Nin, 4))"
"0","dynamic.gpp.df$species <- factor(dynamic.gpp.df$species, levels = c(""average"", ""diatoms"", ""greens"", ""cyanos""))"
"0",""
"0","# # sneak peak of data"
"0","dynamic.gpp.df %>% ggplot(aes(Pin, Nin, fill = GPP)) +"
"0","  geom_raster() + facet_wrap(species~.) +"
"0","  scale_fill_viridis_c()"
