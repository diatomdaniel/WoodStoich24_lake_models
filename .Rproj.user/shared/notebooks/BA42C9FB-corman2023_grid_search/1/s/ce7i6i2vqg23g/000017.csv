"0",""
"0","#takes over an hour to run!!"
"0","droop.grid <- lapply(1:nrow(grid.droop.new), function(i){"
"0","  # indexing"
"0","  params.droop[""KP1""] = grid.droop.new[i, ""KP1""]"
"0","  params.droop[""KN1""] = grid.droop.new[i, ""KN1""]"
"0","  params.droop[""minQP1""] = grid.droop.new[i, ""minQP1""]"
"0","  params.droop[""minQN1""] = grid.droop.new[i, ""minQN1""]"
"0","  params.droop[""upP1""] = grid.droop.new[i, ""upP1""]"
"0","  params.droop[""upN1""] = grid.droop.new[i, ""upN1""]"
"0","  params.droop[""Pin""] = grid.droop.new[i, ""TP_load""]"
"0","  params.droop[""Nin""] = grid.droop.new[i, ""TN_load""]"
"0","  # starting values"
"0","  y <- c(""A1"" = 100, ""P"" = grid.droop.new[i, ""TP_load""],"
"0","         ""N"" = grid.droop.new[i, ""TN_load""],"
"0","         ""QP1"" = 0.015,"
"0","         ""QN1"" = 0.1)"
"0","  run <- ode(y, times, parms = params.droop, func = droop.single)"
"0","  return(run[max(times),])"
"0","})"
"0","# convert to df"
"0","droop.grid <- do.call(rbind, droop.grid)"
"0","droop.grid <- as_data_frame(droop.grid)"
"0",""
"0","# grids take too long to run, gonna save to r data file and reload for convenience"
"0","save(droop.grid,file = ""temporary_model_files/corman2023_droop_gridsearch.Rdata"")"
"0","load(""temporary_model_files/corman2023_droop_gridsearch.Rdata"")"
"0",""
"0","# add to grid"
"0","grid.droop.new$est_GPP <- droop.grid$A1"
"0",""
"0",""
