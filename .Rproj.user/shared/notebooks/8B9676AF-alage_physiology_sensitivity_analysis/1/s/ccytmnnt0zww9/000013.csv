"0","# merge scenarios"
"0","sim.droop <- rbind(sim.droop.1, sim.droop.2)"
"0","colnames(sim.droop) <- c(""time"", ""A1.sim"", ""P.sim"", ""N.sim"", ""GPP.sim"","
"0","                        ""QP.sim"", ""QN.sim"", ""Pin"", ""Nin"", "
"0","                        ""param"", ""scenario"")"
"0","sim.droop <- merge(sim.droop, baselines.droop, "
"0","                  by = c(""Pin"", ""Nin"", ""time""))"
"0","# calculate percent change relative to baseline"
"0","# for algal biomass"
"0","sim.droop$change2baseline.gpp <- sim.droop$GPP.sim * 100/sim.droop$GPP - 100"
"0","# for cell P content"
"0","sim.droop$change2baseline.QP <- sim.droop$QP.sim * 100/sim.droop$QP1 - 100"
"0","# for cell N content"
"0","sim.droop$change2baseline.QN <- sim.droop$QN.sim * 100/sim.droop$QN1 - 100"
"0",""
"0","# determine min/max change"
"0","# note that this code doesn't tell us about direction of change, only the magnitude"
"0","sim.droop.metrics.gpp <- sim.droop %>% "
"0","  mutate(change2baseline2 =  abs(change2baseline.gpp)) %>% "
"0","  pivot_wider(id_cols = c(Pin, Nin, scenario),"
"0","              names_from = param, "
"0","              values_from = change2baseline2)"
"0","colnames(sim.droop.metrics.gpp)"
"1","[1]"
"1"," ""Pin""     "
"1"," ""Nin""     "
"1"," ""scenario"""
"1"," ""KP1""     "
"1"," ""KN1""     "
"1"," ""upP1""    "
"1"," ""upN1""    "
"1"," ""minQP1""  "
"1"," ""minQN1""  "
"1","
"
"0","sim.droop.metrics.gpp[,-c(1, 2, 3)] <- apply(sim.droop.metrics.gpp[,-c(1, 2, 3)], 2, abs)"
"0","sim.droop.metrics.gpp$max.change <- colnames(sim.droop.metrics.gpp[-c(1,2,3)])[apply(sim.droop.metrics.gpp[,-c(1,2,3)], 1, which.max)]"
"0",""
"0","# for QP"
"0","sim.droop.metrics.QP <- sim.droop %>% "
"0","  mutate(change2baseline2 =  abs(change2baseline.QP)) %>% "
"0","  pivot_wider(id_cols = c(Pin, Nin, scenario),"
"0","              names_from = param, "
"0","              values_from = change2baseline2)"
"0","colnames(sim.droop.metrics.QP)"
"1","[1]"
"1"," ""Pin""     "
"1"," ""Nin""     "
"1"," ""scenario"""
"1"," ""KP1""     "
"1"," ""KN1""     "
"1"," ""upP1""    "
"1"," ""upN1""    "
"1"," ""minQP1""  "
"1"," ""minQN1""  "
"1","
"
"0","sim.droop.metrics.QP[,-c(1, 2, 3)] <- apply(sim.droop.metrics.QP[,-c(1, 2, 3)], 2, abs)"
"0","sim.droop.metrics.QP$max.change <- colnames(sim.droop.metrics.QP[-c(1,2,3)])[apply(sim.droop.metrics.QP[,-c(1,2,3)], 1, which.max)]"
"0",""
"0","# for QN"
"0","sim.droop.metrics.QN <- sim.droop %>%"
"0","  mutate(change2baseline2 =  abs(change2baseline.QN)) %>%"
"0","  pivot_wider(id_cols = c(Pin, Nin, scenario),"
"0","              names_from = param, "
"0","              values_from = change2baseline2)"
"0","colnames(sim.droop.metrics.QN)"
"1","[1]"
"1"," ""Pin""     "
"1"," ""Nin""     "
"1"," ""scenario"""
"1"," ""KP1""     "
"1"," ""KN1""     "
"1"," ""upP1""    "
"1"," ""upN1""    "
"1"," ""minQP1""  "
"1"," ""minQN1""  "
"1","
"
"0","sim.droop.metrics.QN[,-c(1, 2, 3)] <- apply(sim.droop.metrics.QN[,-c(1, 2, 3)], 2, abs)"
"0","sim.droop.metrics.QN$max.change <- colnames(sim.droop.metrics.QN[-c(1,2,3)])[apply(sim.droop.metrics.QN[,-c(1,2,3)], 1, which.max)]"
"0",""
