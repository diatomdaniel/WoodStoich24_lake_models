"0",""
"0","dynamic.grid.search <- expand.grid("
"0","  minQP1 =  seq(0.01, 0.2, 0.01),"
"0","  minQN1 = seq(0.01, 0.2, 0.01),"
"0","  umax1 = c(0.4, 0.6, 0.8)"
"0",")"
"0","dynamic.grid.search$KP1 = 16.5"
"0","dynamic.grid.search$KN1 = 50"
"0","dynamic.grid.search$upP1 = 0.426"
"0","dynamic.grid.search$upN1 = 2.45"
"0","# repeat grid nrow(corman2) times"
"0","dynamic.grid.search2 <- dynamic.grid.search %>% "
"0","  slice(rep(1:n(), each = nrow(corman2)))"
"0",""
"0","# add in corman2 data"
"0","dynamic.grid.search2$Lake <- rep(corman2$Lake, nrow(dynamic.grid.search))"
"0","dynamic.grid.search2$GPP <- rep(corman2$GPP, nrow(dynamic.grid.search))"
"0","dynamic.grid.search2$TN_in <- rep(corman2$TN_in, nrow(dynamic.grid.search))"
"0","dynamic.grid.search2$TP_in <- rep(corman2$TP_in, nrow(dynamic.grid.search))"
"0","dynamic.grid.search2$SA <- rep(corman2$SA, nrow(dynamic.grid.search))"
"0","dynamic.grid.search2$DOC_mgL <- rep(corman2$DOC_mgL, nrow(dynamic.grid.search))"
"0","dynamic.grid.search2$z <- rep(corman2$z, nrow(dynamic.grid.search))"
"0",""
"0","#this would take over 10 hrs to run....maybe best to outsource to HCC??? but can do this later"
"0","(start <- Sys.time())"
"1","[1]"
"1"," ""2024-09-02 13:28:13 CDT"""
"1","
"
"0","dynamic.grid.search.out <- lapply(1:nrow(dynamic.grid.search2), function(i){"
"0","  #print(i)"
"0","  # indexing"
"0","  dynamic.algae[""SA""] = dynamic.grid.search2[i, ""SA""]"
"0","  dynamic.algae[""DOC""] = dynamic.grid.search2[i, ""DOC_mgL""]"
"0","  dynamic.algae[""z""] = dynamic.grid.search2[i, ""z""]"
"0","  dynamic.algae[""KP1""] = dynamic.grid.search2[i, ""KP1""]"
"0","  dynamic.algae[""KN1""] = dynamic.grid.search2[i, ""KN1""]"
"0","  dynamic.algae[""QP1""] = dynamic.grid.search2[i, ""minQP1""]"
"0","  dynamic.algae[""QN1""] = dynamic.grid.search2[i, ""minQN1""]"
"0","  dynamic.algae[""umax1""] = dynamic.grid.search2[i, ""umax1""]"
"0","  dynamic.algae[""Pin""] = dynamic.grid.search2[i, ""TP_in""]"
"0","  dynamic.algae[""Nin""] = dynamic.grid.search2[i, ""TN_in""]"
"0","  # starting values"
"0","  y <- c(""A1"" = 100, ""P"" = dynamic.grid.search2[i, ""TP_in""], ""N"" = dynamic.grid.search2[i, ""TN_in""],"
"0","         ""QP1"" = 0.015, ""QN1"" = 0.1)"
"0","  run <- ode(y, times, parms = dynamic.algae, func = dynamic.stoich.zmix)"
"0","  return(run[max(times),])"
"0","})"
"0","# convert to df"
"0","dynamic.grid.search.out <- do.call(rbind, dynamic.grid.search.out)"
"0","dynamic.grid.search.out <- as_data_frame(dynamic.grid.search.out)"
"0","(end <- Sys.time())"
"1","[1]"
"1"," ""2024-09-02 15:27:15 CDT"""
"1","
"
"0","time.elapsed <- (end - start)"
"0","print(paste0(""Time elapsed = "", time.elapsed, "" hours!""))"
"1","[1]"
"1"," ""Time elapsed = 1.98402529802587 hours!"""
"1","
"
"0","# add to grid"
"0","dynamic.grid.search2$est_GPP <- dynamic.grid.search.out$GPP"
