# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 0.665,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 10 * 0.75, P = 10)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 80, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 0.665,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
A1 <- y["A1"]
P <- y["P"]
N <- y["N"]
# lake parameters
SA= params["SA"]
# z <- params["z"]
# DOC = params["DOC"]
Pin = params["Pin"]
Nin = params["Nin"]
I0 = params["I0"]
# algae physiology parameters
umax1 = params["umax1"]
lA = params["lA"]
v = params["v"]
KLight = params["KLight"]
# species 1
KP1 = params["KP1"]
QP1 = params["QP1"]
KN1 = params["KN1"]
QN1 = params["QN1"]
Klight = params["KLight"]
# zmix
# zmix <- 10^(0.515 * log10(DOC) + 0.115 * log10(2 * sqrt(SA/pi + 0.991)))
# # if zmix exceeds depth, set zmix to z.
# zmix <- ifelse(zmix > z, z, zmix)
zmix <- 2
# In/output
Qin=SA*1e6*zmix/365	# m^3 day^-1
#kD <- 0.0003 * A1 + 0.1
# light attenuation
#Izmix=lightAtten(z=zmix,I0=I0,kD=kD)
# Volume = entire lake is mixed; zmix = zmax
V = SA * 1e6 * zmix
# biomass specific growth for entire mixed layer
# biomass specific growth for entire mixed layer
# species 1
#prod1= (umax1/(kD*zmix))*log((KLight + I0)/(KLight+Izmix))* (P/(P+KP1))*(N/(N + KN1))	# d-1
prod1= umax1 * (P/(P+KP1))*(N/(N + KN1))	# d-1
# model biomass
# species 1
dA1.dt=A1*prod1-lA*A1-v/zmix*A1-Qin/(zmix*SA*1e6)*A1	# total biomass in mg C m^-3
GPP = prod1 * A1/1000 # this is the GPP rate! mg C m^-3 day^-1
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 80, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 0.665,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 80, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 0.665,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 80, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 0.665,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 80, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 130, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 10, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 10, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:10000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 10, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:1000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 10, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:1000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
# Troubleshooting code
# estimating GPP from lake ecosystem models
#pck
library(tidyverse)
library(deSolve)
# fncts
source("models/mich_single_noLight_calc_zmix.R")
# set-up
## michaelis-menten model for mean phytoplankton traits
params <- c(
# lake parameters
SA= 2,		# lake surface area in km2
#zmix = 2, # lake mixing depth in m
Pin = 50, # P inflow concentration in mg P m^-3
Nin = 200, # N inflow concentration in mg N m^-3
# DOC = 5,
# z = 3,
I0 = 300,
# algae physiology parameters
KLight = 100,
umax1 = 1,
lA=0.1,			# mortality rate day-1
v=0.1,			# m d-1; sinking loss of algae
KP1 = 3, # phosphorus half sat constant in mg P m^-3 f
QP1 = 0.015, # algae cell P quota in mg P mg^-1 C^-1
KN1 = 5, # nitrogen half sat constant in mg N m^-3
QN1 = 0.1 # algae cell N quota in mg N mg^-1 C^-1
)
y <- c(A1 = 1, N = 50, P = 80)
times <- 1:1000
run <- ode(y, times, mich.single, parms = params)
run <- as.data.frame(run)
run %>% ggplot(aes(time, A1)) + geom_line()
run %>% ggplot(aes(time, N)) + geom_line()
run %>% ggplot(aes(time, P)) + geom_line()
run %>% ggplot(aes(time, GPP)) + geom_line()
knitr::opts_chunk$set(echo = T, message = F, warning = F)
pck <- c("deSolve", "tidyverse", "cowplot", "ggsci", "ggpubr", "ggtern", "patchwork")
lapply(pck, require, character.only = T)
theme_set(theme_cowplot() +
theme(legend.justification = "center",
legend.position = "bottom",
legend.text = element_text(),
legend.title = element_text()))
# load ODE models
# saved in external files for convenience
# Michalis-Menten model
source("models/mich_single_noLight_calc_zmix.R") # michaelis menten kinetics, one algae species; model 1 in Carly's framework
# Droop model
source("models/droop_single_noLight_calc_zmix.R") # droop model, one algae species; model 3 in Carly's framework
# set up scenarios
times <- 1:500
# load data set
corman <- read_csv("data4input/Corman2023 metabolism result.csv")
# corman data lake volumes
# no DOC for Lillinonah! used median DOC of the data set = 11.8
corman.vol <- tibble(
Lake = c("Acton", "Crampton", "EastLong", "Feeagh", "Harp", "Langtjern",
"Lillinonah", "Lillsjoliden", "Mangstrettjarn",
"Mendota", "Morris", "Nastjarn", "Ovre", "Struptjarn", "Trout", "Vortsjarv"),
Depth_m = c(3.9, 5.03, 4.04, 14.50, 13.30, 2, 13, 3.8, 5.3,
12.80, 2.42, 4.20, 4, 3.80, 14.60, 2.80),
SA_km2 = c(2.5, 0.26, 0.03, 3.92, 0.71, 0.23, 6.26, 0.01, 0.02,
39.60, 0.06, 0.01, 0.05, 0.03, 15.70, 270),
DOC_mgL = c(4.3, 4.6, 10.6, 5.6, 5.2, 11.8, 11.8, 15.5, 11.9, 4.7, 17.3, 8.2, 23.2, 19.9, 2.8, 11.9)) %>%
mutate(volume_m3 = SA_km2 * 1e6 * Depth_m)
# load data
corman2 <- corman
# select columns needed
corman2 <- corman2 %>%
select(Lake, DateTime, GPP, TN_load, TP_load) %>%
drop_na() %>%
mutate(GPP = GPP * 0.375, # convert from O2 to C: 12 mg per mole C/32 mg per mole O2
TN_load = TN_load/1000,
TP_load = TP_load/1000) %>% # divide by 10^3 bc. Corman et al data is in units ug m^-3 and we need mg m^-3
# merge(., corman.vol, by = "Lake") %>%
# mutate(TN_in = TN_load * volume_m3,
#        TP_in = TP_load * volume_m3) %>%
# # caclulate "new" loads for the model
# mutate(TN_load = TN_in/(2 * 1e6),
#        TP_load = TP_in/(2 * 1e6)) %>%
merge(., corman.vol, by = "Lake") %>%
group_by(Lake) %>%
summarize(GPP = median(GPP),
TN_load = median(TN_load),
TP_load = median(TP_load),
SA = median(SA_km2),
DOC_mgL = median(DOC_mgL),
z_m = median(Depth_m))
# add calculated zmix
corman2$zmix <- 10^(-0.515 + log10(corman2$DOC_mgL) + 0.115 * log10(2 * sqrt(corman2$SA/pi + 0.991)))
# if zmix > z, set zmix to z; this is done in code
View(corman2)
View(corman)
