})
})
exp3.mich2.diatoms <- as_data_frame(do.call(rbind, exp.3.mich2[[1]]))
exp3.mich2.greens <- as_data_frame(do.call(rbind, exp.3.mich2[[2]]))
exp3.mich2.cyanos <- as_data_frame(do.call(rbind, exp.3.mich2[[3]]))
## droop model
# apply over scenarios and algal groups
exp.3.droop2 <-  lapply(list(diatoms.droop, greens.droop, cyanos.droop), function(x) {
params <- x
lapply(1:nrow(exp3.loads2), function(i) {
params["Pin"] = exp3.loads2[i, "Pin"]
params["Nin"] = exp3.loads2[i, "Nin"]
y <- c("A1" = 100, "P" = exp3.loads2[i, "Pin"],"N" = exp3.loads2[i, "Nin"],
"QP1" = 0.015, "QN1" = 0.1)
run <- ode(y, times, parms = params, func = droop.single)
return(run[max(times),])
})
})
exp3.droop2.diatoms <- as_data_frame(do.call(rbind, exp.3.droop2[[1]]))
exp3.droop2.greens <- as_data_frame(do.call(rbind, exp.3.droop2[[2]]))
exp3.droop2.cyanos <- as_data_frame(do.call(rbind, exp.3.droop2[[3]]))
# combine everything into a data frame
exp3.data2 <- bind_rows(
exp3.mich2.diatoms, exp3.mich2.greens, exp3.mich2.cyanos,
exp3.droop2.diatoms, exp3.droop2.greens, exp3.droop2.cyanos
) %>%
mutate(model = rep(c("Michaelis-Menten", "Droop"), each = nrow(exp3.loads2) * 3),
species = rep(c("Diatoms", "Greens", "Cyanos", "Diatoms", "Greens", "Cyanos"),
each = nrow(exp3.loads2)),
Pin = rep(exp3.loads2$Pin, 6),
Nin = rep(exp3.loads2$Nin, 6),
NP_inflpw = rep(exp3.loads2$NP_inflow, 6)) %>%
mutate(model = factor(model, levels = c("Michaelis-Menten", "Droop")),
species = factor(species, levels = c("Diatoms", "Greens", "Cyanos")))
View(exp3.data2)
install.packages("ggtern")
library(ggtern)
(fig.exp3.gpp <- exp3.data %>%
ggplot(aes(Pin, Nin, fill = A1)) +
geom_raster() +
facet_grid(model~species) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("GPP mg C m"^-2 ~ "day"^-1)) +
scale_fill_viridis_b(option = "C"))
pck <- c("deSolve", "tidyverse", "cowplot", "ggsci", "ggpubr", "ggtern")
lapply(pck, require, character.only = T)
theme_set(theme_cowplot() +
theme(legend.justification = "center",
legend.position = "bottom"))
# load ODE models
# saved in external files for convenience
# Michalis-Menten model
source("models/mich_single_noLight.R") # michaelis menten kinetics, one algae species; model 1 in Carly's framework
# Droop model
source("models/droop_single_noLight.R") # droop model, one algae species; model 3 in Carly's framework
# load file with phytoplankton traits
traits <- read_csv("data4input/phyto_traits4models_21June2024.csv")[,-1]
# set up scenarios
times <- 1:500
## plot N:P for experiment 3
# QN
(fig.exp3.np1 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QN1)) +
geom_raster() +
facet_wrap(model~species) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg N mg C"^-1)) +
scale_fill_viridis_b(option = "C"))
## plot N:P for experiment 3
# QN
(fig.exp3.np1 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QN1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg N mg C"^-1)) +
scale_fill_viridis_b(option = "C"))
# plot GPP for experiment 3
(fig.exp3.gpp <- exp3.data %>%
ggplot(aes(Pin, Nin, fill = A1)) +
geom_raster() +
facet_grid(model~species) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("GPP mg C m"^-2 ~ "day"^-1)) +
scale_fill_viridis_b(option = "C"))
## plot N:P for experiment 3
# QN
fig.exp3.np1 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QN1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg N mg C"^-1)) +
scale_fill_viridis_b(option = "C")
# QP
fig.exp3.np2 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QP1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg P mg C"^-1)) +
scale_fill_viridis_b(option = "C")
# N:P
fig.exp3.np3 <- exp1.data %>%
filter(model == "Droop") %>%
mutate(N_P_cell = (QN1/14.007)/(QP1/30.974)) %>%
ggplot(aes(Pin, Nin, fill = N_P_cell)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("N:P molar")) +
scale_fill_viridis_b(option = "C")
# merge to produce figure
fig.exp3.np <- ggarrange(
plotlist = list(fig.exp3.np1, fig.exp3.np2, fig.exp3.np3),
nrow = 3, ncol = 1, align = "hv", labels = c("a", "b", "c"))
# N:P
fig.exp3.np3 <- exp3.data %>%
filter(model == "Droop") %>%
mutate(N_P_cell = (QN1/14.007)/(QP1/30.974)) %>%
ggplot(aes(Pin, Nin, fill = N_P_cell)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("N:P molar")) +
scale_fill_viridis_b(option = "C")
# merge to produce figure
fig.exp3.np <- ggarrange(
plotlist = list(fig.exp3.np1, fig.exp3.np2, fig.exp3.np3),
nrow = 3, ncol = 1, align = "hv", labels = c("a", "b", "c"))
fig.exp3.np
# nutrient loads
# P = 0.005 to 0.150 g m^-3 = 5 to 150 mg m^-3
# N = 0.005 to 0.150 g m^-3 = 5 to 150 mg m^-3
exp3.loads <- expand.grid(Pin = seq(5, 500,20),
Nin = seq(5, 1000, 20))
## michaelis-menten model
# apply over scenarios and algal groups
exp.3.mich <-  lapply(list(diatoms.mich, greens.mich, cyanos.mich), function(x) {
params <- x
lapply(1:nrow(exp3.loads), function(i) {
params["Pin"] = exp3.loads[i, "Pin"]
params["Nin"] = exp3.loads[i, "Nin"]
y <- c("A1" = 100, "P" = exp3.loads[i, "Pin"],"N" = exp3.loads[i, "Nin"])
run <- ode(y, times, parms = params, func = mich.single)
return(run[max(times),])
})
})
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(model~species, ncol = 2, nrow = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(model~species, ncol = 3, nrow = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(model~species, ncol = 3, nrow = 2) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
exp3.data2
# nutrient loads
# P = 0.005 to 0.150 g m^-3 = 5 to 150 mg m^-3
# N:P = 22.61, 13.57, 9.04, 7.24, 4.52, 2.26  by mass
exp3.loads2 <- expand.grid(Pin = seq(5, 150,10),
NP_inflow = c(90.44, 22.61, 7.24, 2.26))
exp3.loads2$Nin <- exp3.loads2$Pin * exp3.loads2$NP_inflow
## michaelis-menten model
# apply over scenarios and algal groups
exp.3.mich2 <-  lapply(list(diatoms.mich, greens.mich, cyanos.mich), function(x) {
params <- x
lapply(1:nrow(exp3.loads2), function(i) {
params["Pin"] = exp3.loads2[i, "Pin"]
params["Nin"] = exp3.loads2[i, "Nin"]
y <- c("A1" = 100, "P" = exp3.loads2[i, "Pin"],"N" = exp3.loads2[i, "Nin"])
run <- ode(y, times, parms = params, func = mich.single)
return(run[max(times),])
})
})
exp3.mich2.diatoms <- as_data_frame(do.call(rbind, exp.3.mich2[[1]]))
exp3.mich2.greens <- as_data_frame(do.call(rbind, exp.3.mich2[[2]]))
exp3.mich2.cyanos <- as_data_frame(do.call(rbind, exp.3.mich2[[3]]))
## droop model
# apply over scenarios and algal groups
exp.3.droop2 <-  lapply(list(diatoms.droop, greens.droop, cyanos.droop), function(x) {
params <- x
lapply(1:nrow(exp3.loads2), function(i) {
params["Pin"] = exp3.loads2[i, "Pin"]
params["Nin"] = exp3.loads2[i, "Nin"]
y <- c("A1" = 100, "P" = exp3.loads2[i, "Pin"],"N" = exp3.loads2[i, "Nin"],
"QP1" = 0.015, "QN1" = 0.1)
run <- ode(y, times, parms = params, func = droop.single)
return(run[max(times),])
})
})
exp3.droop2.diatoms <- as_data_frame(do.call(rbind, exp.3.droop2[[1]]))
exp3.droop2.greens <- as_data_frame(do.call(rbind, exp.3.droop2[[2]]))
exp3.droop2.cyanos <- as_data_frame(do.call(rbind, exp.3.droop2[[3]]))
# combine everything into a data frame
exp3.data2 <- bind_rows(
exp3.mich2.diatoms, exp3.mich2.greens, exp3.mich2.cyanos,
exp3.droop2.diatoms, exp3.droop2.greens, exp3.droop2.cyanos
) %>%
mutate(model = rep(c("Michaelis-Menten", "Droop"), each = nrow(exp3.loads2) * 3),
species = rep(c("Diatoms", "Greens", "Cyanos", "Diatoms", "Greens", "Cyanos"),
each = nrow(exp3.loads2)),
Pin = rep(exp3.loads2$Pin, 6),
Nin = rep(exp3.loads2$Nin, 6),
NP_inflow = rep(exp3.loads2$NP_inflow, 6)) %>%
mutate(model = factor(model, levels = c("Michaelis-Menten", "Droop")),
species = factor(species, levels = c("Diatoms", "Greens", "Cyanos")))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(model~species, ncol = 3, nrow = 2) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_grid(model~species, ncol = 3, nrow = 2) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_grid(model~species) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_grid(model~species) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
color = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
theme_set(theme_cowplot() +
theme(legend.justification = "center",
legend.position = "bottom",
legend.text = element_text(),
legend.title = element_text()))
## plot GPP for experiment 3 pt 2
(fig.exp3.gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_grid(model~species) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
color = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot N:P for experiment 3 pt2
# QN
fig.exp3.pt.2np1 <- exp3.data2 %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, QN1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(species~.) +
labs(x = expression("Inflow P mg m"^-3), y = expression("mg N mg C"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0)
fig.exp3.pt.2np1
# QP
fig.exp2.pt2.np2 <- exp2.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, QP1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(species~.) +
labs(x = expression("Inflow P mg m"^-3), y = expression("mg P mg C"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0)
## plot GPP for experiment 3 pt 2
(fig.exp3.pt.2gpp <- exp3.data2 %>%
ggplot(aes(Pin, A1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_grid(model~species) +
labs(x = expression("Inflow P mg m"^-3), y = expression("GPP mg C m"^-2 ~ "day"^-1),
color = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0))
## plot N:P for experiment 3 pt2
# QN
fig.exp3.pt.2np1 <- exp3.data2 %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, QN1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(species~.) +
labs(x = expression("Inflow P mg m"^-3), y = expression("mg N mg C"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0)
# QP
fig.exp3.pt2.np2 <- exp3.data2 %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, QP1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(species~.) +
labs(x = expression("Inflow P mg m"^-3), y = expression("mg P mg C"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0)
# N:P
fig.exp3.pt2.np3 <- exp3.data2 %>%
filter(model == "Droop") %>%
mutate(N_P_cell = QN1/QP1) %>%
ggplot(aes(Pin, N_P_cell, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(species~.) +
labs(x = expression("Inflow P mg m"^-3), y = "Cell N:P mass",
col = "Inflow N:P (mass)")  +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0)
# merge to produce figure
fig.exp3.pt2.np <- ggarrange(
plotlist = list(fig.exp3.pt2.np1, fig.exp3.pt2.np2, fig.exp3.pt2.np3),
nrow = 1, ncol = 3, align = "hv", labels = c("a", "b", "c"))
## plot N:P for experiment 3 pt2
# QN
fig.exp3.pt2.np1 <- exp3.data2 %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, QN1, col = NP_inflow, group = NP_inflow)) +
geom_line(lwd = 1) +
facet_wrap(species~.) +
labs(x = expression("Inflow P mg m"^-3), y = expression("mg N mg C"^-1),
col = "Inflow N:P (mass)") +
scale_color_viridis_b(option = "C", breaks = round(c(90.44, 22.61, 7.24, 2.26)), 0)
# merge to produce figure
fig.exp3.pt2.np <- ggarrange(
plotlist = list(fig.exp3.pt2.np1, fig.exp3.pt2.np2, fig.exp3.pt2.np3),
nrow = 1, ncol = 3, align = "hv", labels = c("a", "b", "c"))
fig.exp3.pt2.np
# plot GPP for experiment 3
(fig.exp3.gpp <- exp3.data %>%
ggplot(aes(Pin, Nin, fill = A1)) +
geom_raster() +
facet_grid(model~species) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("GPP mg C m"^-2 ~ "day"^-1)) +
scale_fill_viridis_b(option = "C"))
## plot N:P for experiment 3
# QN
fig.exp3.np1 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QN1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg N mg C"^-1)) +
scale_fill_viridis_b(option = "C")
# QP
fig.exp3.np2 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QP1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg P mg C"^-1)) +
scale_fill_viridis_b(option = "C")
# N:P
fig.exp3.np3 <- exp3.data %>%
filter(model == "Droop") %>%
mutate(N_P_cell = (QN1/14.007)/(QP1/30.974)) %>%
ggplot(aes(Pin, Nin, fill = N_P_cell)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("N:P molar")) +
scale_fill_viridis_b(option = "C")
# merge to produce figure
fig.exp3.np <- ggarrange(
plotlist = list(fig.exp3.np1, fig.exp3.np2, fig.exp3.np3),
nrow = 3, ncol = 1, align = "hv", labels = c("a", "b", "c"))
fig.exp3.np
# nutrient loads
# P = 0.005 to 0.150 g m^-3 = 5 to 150 mg m^-3
# N = 0.005 to 0.150 g m^-3 = 5 to 150 mg m^-3
exp3.loads <- expand.grid(Pin = seq(5, 500,20),
Nin = seq(5, 1000, 20))
## michaelis-menten model
# apply over scenarios and algal groups
exp.3.mich <-  lapply(list(diatoms.mich, greens.mich, cyanos.mich), function(x) {
params <- x
lapply(1:nrow(exp3.loads), function(i) {
params["Pin"] = exp3.loads[i, "Pin"]
params["Nin"] = exp3.loads[i, "Nin"]
y <- c("A1" = 100, "P" = exp3.loads[i, "Pin"],"N" = exp3.loads[i, "Nin"])
run <- ode(y, times, parms = params, func = mich.single)
return(run[max(times),])
})
})
exp3.mich.diatoms <- as_data_frame(do.call(rbind, exp.3.mich[[1]]))
exp3.mich.greens <- as_data_frame(do.call(rbind, exp.3.mich[[2]]))
exp3.mich.cyanos <- as_data_frame(do.call(rbind, exp.3.mich[[3]]))
## droop model
# apply over scenarios and algal groups
exp.3.droop <-  lapply(list(diatoms.droop, greens.droop, cyanos.droop), function(x) {
params <- x
lapply(1:nrow(exp3.loads), function(i) {
params["Pin"] = exp3.loads[i, "Pin"]
params["Nin"] = exp3.loads[i, "Nin"]
y <- c("A1" = 100, "P" = exp3.loads[i, "Pin"],"N" = exp3.loads[i, "Nin"],
"QP1" = 0.015, "QN1" = 0.1)
run <- ode(y, times, parms = params, func = droop.single)
return(run[max(times),])
})
})
exp3.droop.diatoms <- as_data_frame(do.call(rbind, exp.3.droop[[1]]))
exp3.droop.greens <- as_data_frame(do.call(rbind, exp.3.droop[[2]]))
exp3.droop.cyanos <- as_data_frame(do.call(rbind, exp.3.droop[[3]]))
# combine everything into a data frame
exp3.data <- bind_rows(
exp3.mich.diatoms, exp3.mich.greens, exp3.mich.cyanos,
exp3.droop.diatoms, exp3.droop.greens, exp3.droop.cyanos
) %>%
mutate(model = rep(c("Michaelis-Menten", "Droop"), each = nrow(exp3.loads) * 3),
species = rep(c("Diatoms", "Greens", "Cyanos", "Diatoms", "Greens", "Cyanos"),
each = nrow(exp3.loads)),
Pin = rep(exp3.loads$Pin, 6),
Nin = rep(exp3.loads$Nin, 6)) %>%
mutate(model = factor(model, levels = c("Michaelis-Menten", "Droop")),
species = factor(species, levels = c("Diatoms", "Greens", "Cyanos")))
# plot GPP for experiment 3
(fig.exp3.gpp <- exp3.data %>%
ggplot(aes(Pin, Nin, fill = A1)) +
geom_raster() +
facet_grid(model~species) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("GPP mg C m"^-2 ~ "day"^-1)) +
scale_fill_viridis_b(option = "C"))
## plot N:P for experiment 3
# QN
fig.exp3.np1 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QN1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg N mg C"^-1)) +
scale_fill_viridis_b(option = "C")
# QP
fig.exp3.np2 <- exp3.data %>%
filter(model == "Droop") %>%
ggplot(aes(Pin, Nin, fill = QP1)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("mg P mg C"^-1)) +
scale_fill_viridis_b(option = "C")
# N:P
fig.exp3.np3 <- exp3.data %>%
filter(model == "Droop") %>%
mutate(N_P_cell = (QN1/14.007)/(QP1/30.974)) %>%
ggplot(aes(Pin, Nin, fill = N_P_cell)) +
geom_raster() +
facet_wrap(species~.) +
geom_abline(intercept = 0, slope = 16*14.007/30.974,
lty = "dashed", col = "white", lwd = 1) +
labs(x = expression("Inflow P mg m"^-3), y = expression("Inflow N mg m"^-3),
fill = expression("N:P molar")) +
scale_fill_viridis_b(option = "C")
# merge to produce figure
fig.exp3.np <- ggarrange(
plotlist = list(fig.exp3.np1, fig.exp3.np2, fig.exp3.np3),
nrow = 3, ncol = 1, align = "hv", labels = c("a", "b", "c"))
fig.exp3.np
